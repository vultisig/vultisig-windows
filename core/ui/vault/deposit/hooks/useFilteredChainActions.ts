import { Chain } from '@core/chain/Chain'
import { knownTokens } from '@core/chain/coin/knownTokens'
import { DepositEnabledChain } from '@core/ui/vault/deposit/DepositEnabledChain'
import { useMemo } from 'react'

import { featureFlags } from '../../../config'
import { useCurrentVaultCoins } from '../../state/currentVaultCoins'
import { ChainAction, chainActionsRecord } from '../ChainAction'

const rujiAction: ChainAction[] = [
  'stake_ruji',
  'unstake_ruji',
  'withdraw_ruji_rewards',
]

export const useFilteredChainActions = (chain: DepositEnabledChain) => {
  const actionsForCurrentChain = chainActionsRecord[chain]
  const rujiCoin = useCurrentVaultCoins().find(
    coin =>
      coin.id ===
      knownTokens[Chain.THORChain].find(t => t.ticker === 'RUJI')?.id
  )

  return useMemo(() => {
    return actionsForCurrentChain.filter(action => {
      if (
        !featureFlags.mintAndRedeem &&
        (action === 'mint' || action === 'redeem')
      ) {
        return false
      }

      if (!rujiCoin && rujiAction.includes(action)) {
        return false
      }

      return true
    })
  }, [actionsForCurrentChain, rujiCoin])
}
